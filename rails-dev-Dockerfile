FROM phusion/baseimage
ENV RUBYVERSION 2.3.0

RUN apt-get update

RUN apt-get install -y build-essential
RUN apt-get install -y nodejs sqlite3 curl

ENV WRESTLINGDEV_SECRET_KEY_BASE 077cdbef5c2ccf22543fb17a67339f234306b7fa2e1e4463d851c444c10a5611829a2290b253da78339427f131571fac9a42c83d960b2d25ecc10a4a0a7ce1a2
ENV WRESTLINGDEV_DEVISE_SECRET_KEY 2f29d49db6704377ba263f7cb9db085b386bcb301c0cd501126a674686ab1a109754071165b08cd72af03cec4642a4dd04361c994462254dd5d85e9594e8b9aa

#Install ruby
RUN gpg --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3
RUN \curl -sSL https://get.rvm.io | bash -s stable
RUN source /usr/local/rvm/scripts/rvm
RUN rvm install $RUBYVERSION
RUN rvm rvm --default use $RUBYVERSION
ENV PATH /usr/local/rvm/bin:$PATH


RUN gem install --no-rdoc --no-ri bundler
ADD Gemfile* /tmp/
WORKDIR /tmp
RUN bundle install --without production

RUN npm install -g lineman
ADD frontend/package.json /tmp/
RUN npm install

RUN mkdir /rails
WORKDIR /rails
RUN cp -a /tmp/node_modules /rails/frontend/node_modules
VOLUME ["/rails"]

EXPOSE 3000

CMD /bin/bash
